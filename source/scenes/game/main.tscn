[gd_scene load_steps=10 format=3 uid="uid://c7o053tqqd5m2"]

[ext_resource type="Script" path="res://scenes/game/main.gd" id="1_opyfo"]
[ext_resource type="PackedScene" uid="uid://brsx201tf1fsy" path="res://nodes/map/world.tscn" id="2_5wro5"]
[ext_resource type="PackedScene" uid="uid://drelxuvmh5664" path="res://nodes/player/player.tscn" id="3_myx3p"]
[ext_resource type="Texture2D" uid="uid://doolw6axapnxb" path="res://nodes/player/model/player_1.png" id="4_03wcr"]
[ext_resource type="PackedScene" uid="uid://c3bt4rg67wn8q" path="res://resources/gui/gui.tscn" id="8_vvwwi"]
[ext_resource type="AudioStream" uid="uid://c8rxm7vaxv1pd" path="res://sfx/main_theme.ogg" id="9_g2be0"]
[ext_resource type="AudioStream" uid="uid://c5bda5dqfxbty" path="res://sfx/ambience_forest.wav" id="10_nyo1f"]

[sub_resource type="GDScript" id="GDScript_74j5c"]
script/source = "extends Node

func _process(_delta):
	if Input.is_action_just_released(\"Enter\"):
		get_tree().paused = false
		
func _input(event):
	if not (event is InputEventMouseMotion):
		logging.add_input(event.as_text())

"

[sub_resource type="GDScript" id="GDScript_5gs57"]
script/source = "extends Node2D

func _process(_delta):
	queue_redraw()

func _draw():
	for camera_id in globals.cameras.size():
		var vieport_size = get_viewport().size * 0.5
		var vieport_offset = Vector2((floori(camera_id/2.0))%2, camera_id%2 )
		var vieport_rect = Rect2(vieport_offset * vieport_size, vieport_size)
		draw_rect(vieport_rect, Color.GREEN, false)


#	for camera_id in globals.cameras.size():
#		bounding_rect = Rect2() 
#		bounding_rect.position = globals.cameras[camera_id].unproject_position(%MeshInstance3D.global_position) 
#		# BBOX na Viewport coords
#		for i in b_box_points.size():
#			bounding_rect = bounding_rect.expand(globals.cameras[camera_id].unproject_position(%MeshInstance3D.to_global(b_box_points[i])))
#		var vieport_size = get_viewport().size * 0.5
#		var vieport_offset = Vector2(camera_id%2, (floori(camera_id/2))%2)
#
#		var vieport_rect = Rect2(vieport_offset * vieport_size, vieport_size)
#
#		bounding_rect.position += vieport_offset * vieport_size
#		bounding_rect = bounding_rect.intersection(vieport_rect)
"

[node name="viewports" type="Node"]
script = ExtResource("1_opyfo")

[node name="Pauser" type="Node" parent="."]
process_mode = 2
script = SubResource("GDScript_74j5c")

[node name="world" parent="." instance=ExtResource("2_5wro5")]

[node name="ViewportsContainer" type="GridContainer" parent="."]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0

[node name="Player1" type="SubViewportContainer" parent="ViewportsContainer"]
layout_mode = 2
size_flags_horizontal = 3
size_flags_vertical = 3
stretch = true

[node name="SubViewport" type="SubViewport" parent="ViewportsContainer/Player1"]
handle_input_locally = false
audio_listener_enable_3d = true
gui_disable_input = true
size = Vector2i(1920, 1080)
render_target_update_mode = 4

[node name="player" parent="ViewportsContainer/Player1/SubViewport" instance=ExtResource("3_myx3p")]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, -31.5596, 1, -61.4669)
player_texture = ExtResource("4_03wcr")
player_enabled = true

[node name="Player3" type="SubViewportContainer" parent="ViewportsContainer"]
visible = false
layout_mode = 2
size_flags_horizontal = 3
size_flags_vertical = 3
stretch = true

[node name="SubViewport" type="SubViewport" parent="ViewportsContainer/Player3"]
handle_input_locally = false
audio_listener_enable_3d = true
gui_disable_input = true
size = Vector2i(2, 2)
render_target_update_mode = 0

[node name="player_spawn" type="Marker3D" parent="ViewportsContainer/Player3/SubViewport"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 34.211, 1, -89.808)
gizmo_extents = 1.0

[node name="Player2" type="SubViewportContainer" parent="ViewportsContainer"]
visible = false
layout_mode = 2
size_flags_horizontal = 3
size_flags_vertical = 3
stretch = true

[node name="SubViewport" type="SubViewport" parent="ViewportsContainer/Player2"]
handle_input_locally = false
audio_listener_enable_3d = true
gui_disable_input = true
size = Vector2i(2, 2)
render_target_update_mode = 0

[node name="player_spawn" type="Marker3D" parent="ViewportsContainer/Player2/SubViewport"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 49.254, 1, 11.733)
gizmo_extents = 5.0

[node name="Player4" type="SubViewportContainer" parent="ViewportsContainer"]
visible = false
layout_mode = 2
size_flags_horizontal = 3
size_flags_vertical = 3
stretch = true

[node name="SubViewport" type="SubViewport" parent="ViewportsContainer/Player4"]
handle_input_locally = false
audio_listener_enable_3d = true
gui_disable_input = true
size = Vector2i(2, 2)
render_target_update_mode = 0

[node name="player_spawn" type="Marker3D" parent="ViewportsContainer/Player4/SubViewport"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, -43.734, 1, 7.974)

[node name="GUI" parent="." instance=ExtResource("8_vvwwi")]

[node name="music" type="AudioStreamPlayer" parent="."]
stream = ExtResource("9_g2be0")
volume_db = -12.0
autoplay = true
bus = &"Music"

[node name="ambient" type="AudioStreamPlayer" parent="."]
stream = ExtResource("10_nyo1f")
volume_db = -22.0
autoplay = true
bus = &"Ambient"

[node name="Dialog" type="Node" parent="."]

[node name="CanvasLayer" type="CanvasLayer" parent="."]
visible = false

[node name="Node2D" type="Node2D" parent="CanvasLayer"]
script = SubResource("GDScript_5gs57")
